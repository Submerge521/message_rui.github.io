name: ğŸ’Œ WeChat Daily Push

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *' # UTC æ—¶é—´æ¯å¤© 00:00

jobs:
  push-message:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # âš ï¸ å…³é”®ï¼šè·å–å®Œæ•´å†å²ä»¥æ”¯æŒ git push

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'

      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸš€ Run WeChat Push Script
        env:
          WECHAT_APPID: ${{ secrets.WECHAT_APPID }}
          WECHAT_APPSECRET: ${{ secrets.WECHAT_APPSECRET }}
          WECHAT_TEMPLATE_ID: ${{ secrets.WECHAT_TEMPLATE_ID }}
          WECHAT_USER_ID: ${{ secrets.WECHAT_USER_ID }}
          AMAP_KEY: ${{ secrets.AMAP_KEY}}
          CITY: ${{ secrets.CITY }}
          BIRTHDAY: ${{ secrets.BIRTHDAY }}
          RELATIONSHIP_DATE: ${{ secrets.RELATIONSHIP_DATE }}
          GF_NAME: ${{ secrets.GF_NAME }}
          CONSTELLATION: ${{ secrets.CONSTELLATION }}
        run: |
          python daily_message.py # è¿™ä¸ªè„šæœ¬ä¼šç”Ÿæˆ latest_push.json

      - name: ğŸ“¤ Commit and Push latest_push.json
        if: success()
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}
          # åªæäº¤ latest_push.json
          paths: |
            latest_push.json
          commit_message: "ğŸ“ è‡ªåŠ¨æ›´æ–°: å‘é€å¾®ä¿¡æ¨é€å¹¶è®°å½•å†…å®¹ $(date '+%Y-%m-%d %H:%M:%S')"
          author_name: GitHub Actions
          author_email: actions@github.com
