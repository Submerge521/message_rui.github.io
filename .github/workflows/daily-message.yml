# æ–‡ä»¶å: .github/workflows/push_message.yml

name: ğŸ’Œ WeChat Daily Push # Workflow çš„åç§°

# è§¦å‘æ¡ä»¶
on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  # å®šæ—¶è§¦å‘ (ä½¿ç”¨ POSIX cron è¯­æ³•)
  # é»˜è®¤è®¾ç½®ä¸º UTC æ—¶é—´æ¯å¤© 00:00 è§¦å‘ (å¯¹åº”åŒ—äº¬æ—¶é—´ 08:00)
  # ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´æ—¶é—´
  schedule:
    - cron: '0 0 * * *' # åˆ†é’Ÿ(0-59) å°æ—¶(0-23) æ—¥(1-31) æœˆ(1-12) æ˜ŸæœŸ(0-6, 0=å‘¨æ—¥)
                        # '0 0 * * *' è¡¨ç¤ºæ¯å¤© UTC 00:00 (å³åŒ—äº¬æ—¶é—´ 08:00)


# ä»»åŠ¡å®šä¹‰
jobs:
  push-message:
    # è¿è¡Œç¯å¢ƒ
    runs-on: ubuntu-latest

    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4 # ä½¿ç”¨å®˜æ–¹çš„ checkout action

      # 2. è®¾ç½® Python ç¯å¢ƒ
      - name: ğŸ Set up Python
        uses: actions/setup-python@v5 # ä½¿ç”¨å®˜æ–¹çš„ setup-python action
        with:
          python-version: '3.13' # æŒ‡å®š Python ç‰ˆæœ¬ï¼Œæ ¹æ®ä½ çš„ä»£ç éœ€æ±‚è°ƒæ•´

      # 3. å®‰è£…ä¾èµ–
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. è¿è¡Œæ¨é€è„šæœ¬
      # å°† GitHub Secrets ä½œä¸ºç¯å¢ƒå˜é‡ä¼ é€’ç»™ Python è„šæœ¬
      - name: ğŸš€ Run WeChat Push Script
        env:
          # å¿…é¡»çš„ Secrets
          WECHAT_APPID: ${{ secrets.WECHAT_APPID }}
          WECHAT_APPSECRET: ${{ secrets.WECHAT_APPSECRET }}
          WECHAT_TEMPLATE_ID: ${{ secrets.WECHAT_TEMPLATE_ID }}
          WECHAT_USER_ID: ${{ secrets.WECHAT_USER_ID }}
          AMAP_KEY: ${{ secrets.AMAP_KEY }}
          
          # å¯é€‰çš„ Secrets (ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä¸‹é¢ run å‘½ä»¤ä¸­ç”¨ -e è®¾ç½®)
          CITY: ${{ secrets.CITY }}
          BIRTHDAY: ${{ secrets.BIRTHDAY }}
          RELATIONSHIP_DATE: ${{ secrets.RELATIONSHIP_DATE }}
          GF_NAME: ${{ secrets.GF_NAME }}
          CONSTELLATION: ${{ secrets.CONSTELLATION }}

        run: |
          # å¦‚æœä½ é€‰æ‹©å°†éæ•æ„Ÿé…ç½®ä¹Ÿæ”¾åœ¨ Secrets é‡Œï¼Œå°±ä¸ç”¨ä¸‹é¢è¿™äº› -e äº†
          # ä½¿ç”¨ python-dotenv æˆ–ç›´æ¥åœ¨å‘½ä»¤è¡Œè®¾ç½®ç¯å¢ƒå˜é‡
          # CITY=å¹¿å· BIRTHDAY=02-16 RELATIONSHIP_DATE=2023-05-20 GF_NAME=å°ç¿ CONSTELLATION=æ°´ç“¶åº§ python push_message.py
          
          # æ¨èæ–¹å¼ï¼šç›´æ¥è¿è¡Œï¼Œæ‰€æœ‰é…ç½®éƒ½ä» secrets è¯»å–
          python daily_message.py
